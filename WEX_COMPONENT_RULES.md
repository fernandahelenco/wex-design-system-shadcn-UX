# WEX Component Rules (NORMATIVE)

This document is BINDING for all component development in this repository.
AI assistants (including Cursor) and human contributors MUST follow these rules.

---

## CURSOR AI GOVERNANCE (MANDATORY)

### Required Prompt Prefix

All Cursor sessions working in this repository MUST begin with:

> "Follow WEX_COMPONENT_RULES.md as a hard constraint. Reject changes that violate it."

### Constraint Verification

Before proposing any component change, Cursor MUST:
1. Read this file
2. Verify the proposed change against all rules below
3. Reject or flag any violation before proceeding

### Violations

If a proposed change violates these rules, Cursor MUST:
1. Identify the specific rule being violated
2. Explain why the change violates it
3. Propose a compliant alternative

---

## 1. Token Usage (NON-NEGOTIABLE)

### 1.1 No Raw Colors

- NEVER use hex values, rgb(), or hsl() with literal values
- ALWAYS use Tailwind utilities that resolve to CSS variables
- ALLOWED: `bg-primary`, `text-foreground`, `border-input`
- FORBIDDEN: `bg-blue-500`, `text-[#003366]`, `border-gray-300`

### 1.2 No Arbitrary Value Wrappers for Colors

- NEVER use `bg-[hsl(var(--wex-*))]` or similar arbitrary value patterns
- ALWAYS use named Tailwind utilities (e.g., `hover:bg-primary-hover`)
- If a state color is missing from Tailwind config, ADD IT to the config
- Do NOT work around missing utilities with arbitrary values

**Whitelisted Direct WEX Variable Access:**

The following `--wex-*` variables MAY be accessed directly in component classes (not via arbitrary wrappers):
- `--wex-focus-ring-width` (for focus ring sizing)
- `--wex-focus-ring-offset` (for focus ring offset)
- `--wex-min-target` (for minimum target sizing)

These are non-color values where Tailwind arbitrary value syntax is acceptable:

```
focus-visible:ring-[length:var(--wex-focus-ring-width)]
```

### 1.3 No Raw Sizing for Interactive Elements

- ALWAYS use `min-h-target min-w-target` for buttons and interactive controls
- This ensures 44x44px minimum touch target per WCAG 2.5.5

### 1.4 Focus States Required

- ALL interactive components MUST have visible focus-visible states
- Use the standard pattern:

```
focus-visible:outline-none
focus-visible:ring-[length:var(--wex-focus-ring-width)]
focus-visible:ring-ring
focus-visible:ring-offset-[length:var(--wex-focus-ring-offset)]
focus-visible:ring-offset-background
```

---

## 2. Component Architecture (NON-NEGOTIABLE)

### 2.1 CVA Required for Variants

- ALL components with variants MUST use class-variance-authority
- Variant names must be semantic (intent, size) not visual (blue, large)

### 2.2 asChild Pattern for Polymorphism

- Use @radix-ui/react-slot for components needing polymorphism
- NEVER use `as` prop pattern

### 2.3 ForwardRef Required

- ALL components MUST use React.forwardRef
- displayName MUST be set

---

## 3. File Organization (REQUIRED)

### 3.1 Component Location

- shadcn-style components: `src/components/ui/`
- WEX-specific components: `src/components/ui/wex-*.tsx`

### 3.2 Style Files (Authorship Policy)

| File | Authorship | Notes |
|------|------------|-------|
| `packages/design-tokens/design-tokens.json` | **SOURCE** | Single source of truth for all token values |
| `packages/design-tokens/shadcn-bridge.css` | **HAND-AUTHORED** | Semantic mapping decisions require human intent |
| `packages/design-tokens/components-bridge.css` | **HAND-AUTHORED** | Component-specific slot tokens |

### 3.3 Generation Markers

All CSS/SCSS/TS outputs are generated from `design-tokens.json` via build script:

```css
/* AUTO-GENERATED by build script - DO NOT EDIT */
```

Files with this header MUST NOT be manually edited.

---

## 4. Theme Ownership

### 4.1 Current State

- Token files are generated from `packages/design-tokens/design-tokens.json`
- Changes require updating both light and dark values in `design-tokens.json`
- Run `node scripts/build-tokens.cjs` to regenerate outputs

### 4.2 Generated Files

- Token CSS/SCSS/TS files are GENERATED from `packages/design-tokens/design-tokens.json`
- Source of truth is `packages/design-tokens/design-tokens.json`
- Manual edits to generated files will be overwritten

### 4.3 Bridge Files Remain Manual

- `shadcn-bridge.css` and `components-bridge.css` are HAND-AUTHORED
- Semantic mappings (which WEX token maps to which shadcn slot) require design decisions
- These files must be maintained by humans

---

## 5. Extension Points (ALLOWED)

### 5.1 New Components

- May create new components following patterns above
- Must use existing tokens; new tokens require design approval

### 5.2 New Variants

- May add variants to existing components
- Must use CVA pattern
- Must use existing color tokens

### 5.3 New State Colors

If a component needs a new state (e.g., `--accent-hover`):

1. Add the token to `packages/design-tokens/design-tokens.json` (light and dark)
2. Add the bridge variable to `packages/design-tokens/shadcn-bridge.css` or `components-bridge.css`
3. Run `node scripts/build-tokens.cjs` to regenerate outputs
4. Add the Tailwind color extension to `tailwind.config.ts` if needed
4. Use the named utility in the component

- NEVER use arbitrary values as a workaround

### 5.4 FORBIDDEN Extensions

- New color tokens without design approval
- Raw color values anywhere
- Arbitrary value wrappers for colors
- Components without focus states
- Components without minimum target sizes

---

## 6. Verification Checklist

Before any PR or commit, verify:

- [ ] No raw hex/rgb/hsl values in component files
- [ ] No `bg-[hsl(var(--wex-*))]` patterns (except whitelisted non-color uses)
- [ ] All interactive elements have `min-h-target min-w-target`
- [ ] All interactive elements have focus-visible ring pattern
- [ ] All variant components use CVA
- [ ] All components use forwardRef with displayName
- [ ] Any new state colors follow the extension process (Section 5.3)

---

## 7. Changelog Requirements (MANDATORY)

Any Cursor execution or implementation run that changes code MUST include a Changelog update.

### 7.1 Required Fields

Each changelog entry MUST include:
- **Date**: When the change was made
- **Summary**: Brief description of what changed
- **Pages/Components Affected**: List of files or features touched
- **Breaking Changes**: If any, explicitly noted
- **Accessibility Signal Changes**: If a11y tests were affected, note here

### 7.2 Update Location

Update `src/docs/pages/ChangelogPage.tsx` by adding a new `ChangelogEntry` at the top of the entries list.

### 7.3 Version Numbering

- Patch (0.0.X): Bug fixes, minor styling adjustments
- Minor (0.X.0): New features, new components, significant improvements
- Major (X.0.0): Breaking changes, major refactors

---

## 8. Component Introduction Requirements (MANDATORY)

Any new UI component, wrapper, or reusable abstraction MUST:

1. **Use WEX prefix** - Named `Wex{ComponentName}` (e.g., WexChart, WexButton)
2. **Live in WEX layer** - Located in `src/components/wex/`
3. **Be registered** - Added to component registry for docs navigation
4. **Have docs page** - Include examples in `src/docs/pages/components/`
5. **Participate in a11y** - Examples wrapped in ExampleCard for scanning
6. **Update Changelog** - Document addition in ChangelogPage

### 8.1 Third-Party Wrappers

Components wrapping third-party libraries (e.g., Recharts, date-fns) MUST:

- Expose only the WEX-prefixed public API in docs
- NOT demonstrate raw third-party APIs directly in documentation
- Document any third-party dependencies in the component file header

### 8.2 Namespace Pattern

For compound components (e.g., Dialog with Trigger, Content, etc.), use the namespace pattern:

```tsx
// Export as namespace object
export const WexComponent = {
  Root: ComponentRoot,
  Trigger: ComponentTrigger,
  Content: ComponentContent,
};

// Usage
<WexComponent.Root>
  <WexComponent.Trigger>Open</WexComponent.Trigger>
  <WexComponent.Content>...</WexComponent.Content>
</WexComponent.Root>
```

### 8.3 Non-Compliant Components

If a vendor component cannot be wrapped without breaking functionality:

1. Document the exception in the component file
2. Add to the registry with status: "alpha"
3. Open a tracking issue for future compliance

